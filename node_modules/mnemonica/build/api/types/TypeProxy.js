'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypeProxy = void 0;
const utils_1 = require("../utils");
const { checkProto, } = utils_1.default;
const hop_1 = require("../../utils/hop");
const errors_1 = require("../../descriptors/errors");
const { WRONG_TYPE_DEFINITION, } = errors_1.ErrorsTypes;
const Mnemosyne_1 = require("./Mnemosyne");
const { createMnemosyne, getDefaultPrototype } = Mnemosyne_1.default;
const InstanceCreator_1 = require("./InstanceCreator");
exports.TypeProxy = function (__type__, Uranus) {
    Object.assign(this, {
        __type__,
        Uranus
    });
    const typeProxy = new Proxy(InstanceCreator_1.InstanceCreator, this);
    return typeProxy;
};
exports.TypeProxy.prototype.get = function (target, prop) {
    const { __type__: type } = this;
    if (prop === 'prototype') {
        return type.proto;
    }
    const propDeclaration = type[prop];
    if (propDeclaration) {
        return propDeclaration;
    }
    if ((0, hop_1.hop)(type, prop)) {
        return propDeclaration;
    }
    if (type.subtypes.has(prop)) {
        return type.subtypes.get(prop);
    }
    return Reflect.get(target, prop);
};
exports.TypeProxy.prototype.set = function (_target, name, value) {
    const { __type__: type } = this;
    if (name === 'prototype') {
        checkProto(value);
        Object.assign(type.proto, value);
        return true;
    }
    if (typeof name !== 'string' || !name.length) {
        throw new WRONG_TYPE_DEFINITION('should use non empty string as TypeName');
    }
    if (typeof value !== 'function') {
        throw new WRONG_TYPE_DEFINITION('should use function for type definition');
    }
    const TypeName = name;
    const Constructor = value;
    type.define(TypeName, Constructor);
    return true;
};
const subTypeApply = (parentType, cfg, ...fnArgs) => {
    const decorator = function (cstr) {
        const { name } = cstr;
        return parentType.define(name, cstr, cfg, ...fnArgs);
    };
    return decorator;
};
const primaryTypeApply = function (__, Uranus, args) {
    const type = this.__type__;
    if (Uranus === undefined) {
        const decorator = subTypeApply(type, args[0]);
        return decorator;
    }
    const InstanceCreatorProxy = new exports.TypeProxy(type, Uranus);
    const instance = new InstanceCreatorProxy(...args);
    return instance;
};
Object.defineProperty(exports.TypeProxy.prototype, 'apply', {
    get() {
        return primaryTypeApply;
    }
});
exports.TypeProxy.prototype.construct = function (_target, args) {
    const { __type__: type, Uranus } = this;
    const uranus = type.isSubType ? getDefaultPrototype() : Uranus;
    const mnemosyneProxy = createMnemosyne(uranus);
    const instance = new InstanceCreator_1.InstanceCreator(type, mnemosyneProxy, args);
    return instance;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHlwZVByb3h5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2FwaS90eXBlcy9UeXBlUHJveHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUFJYixvQ0FBa0M7QUFDbEMsTUFBTSxFQUNMLFVBQVUsR0FDVixHQUFHLGVBQVUsQ0FBQztBQUVmLHlDQUFzQztBQUV0QyxxREFBdUQ7QUFDdkQsTUFBTSxFQUNMLHFCQUFxQixHQUNyQixHQUFHLG9CQUFXLENBQUM7QUFFaEIsMkNBQXFDO0FBQ3JDLE1BQU0sRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQUUsR0FBRyxtQkFBVSxDQUFDO0FBRTVELHVEQUFvRDtBQWF2QyxRQUFBLFNBQVMsR0FBRyxVQUFVLFFBQXVDLEVBQUUsTUFBZTtJQUMxRixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtRQUNuQixRQUFRO1FBQ1IsTUFBTTtLQUNOLENBQUMsQ0FBQztJQUNILE1BQU0sU0FBUyxHQUFHLElBQUksS0FBSyxDQUFDLGlDQUFlLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbkQsT0FBTyxTQUFTLENBQUM7QUFDbEIsQ0FBMkMsQ0FBQztBQUU1QyxpQkFBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsVUFBVSxNQUF3QixFQUFFLElBQVk7SUFJekUsTUFBTSxFQUNMLFFBQVEsRUFBRSxJQUFJLEVBQ2QsR0FBRyxJQUFJLENBQUM7SUFLVCxJQUFJLElBQUksS0FBSyxXQUFXLEVBQUUsQ0FBQztRQUMxQixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDbkIsQ0FBQztJQUVELE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBRSxJQUFJLENBQUUsQ0FBQztJQUNyQyxJQUFJLGVBQWUsRUFBRSxDQUFDO1FBQ3JCLE9BQU8sZUFBZSxDQUFDO0lBQ3hCLENBQUM7SUFJRCxJQUFJLElBQUEsU0FBRyxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3JCLE9BQU8sZUFBZSxDQUFDO0lBQ3hCLENBQUM7SUFHRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDN0IsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztBQUVsQyxDQUFDLENBQUM7QUFFRixpQkFBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsVUFBVSxPQUFnQixFQUFFLElBQVksRUFBRSxLQUFjO0lBRWpGLE1BQU0sRUFDTCxRQUFRLEVBQUUsSUFBSSxFQUNkLEdBQUcsSUFBSSxDQUFDO0lBR1QsSUFBSSxJQUFJLEtBQUssV0FBVyxFQUFFLENBQUM7UUFDMUIsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNqQyxPQUFPLElBQUksQ0FBQztJQUNiLENBQUM7SUFFRCxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUM5QyxNQUFNLElBQUkscUJBQXFCLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBRUQsSUFBSSxPQUFPLEtBQUssS0FBSyxVQUFVLEVBQUUsQ0FBQztRQUNqQyxNQUFNLElBQUkscUJBQXFCLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBRUQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDO0lBQ3RCLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQztJQUUxQixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNuQyxPQUFPLElBQUksQ0FBQztBQUViLENBQUMsQ0FBQztBQUlGLE1BQU0sWUFBWSxHQUFHLENBQ3BCLFVBQWtHLEVBQ2xHLEdBQXdCLEVBQ3hCLEdBQUcsTUFBaUIsRUFDbkIsRUFBRTtJQUVILE1BQU0sU0FBUyxHQUFHLFVBQXlDLElBQU87UUFFakUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQztRQUd0QixPQUFPLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQWlCLENBQUM7SUFDdEUsQ0FBQyxDQUFDO0lBQ0YsT0FBTyxTQUFTLENBQUM7QUFDbEIsQ0FBQyxDQUFDO0FBR0YsTUFBTSxnQkFBZ0IsR0FBRyxVQUd4QixFQUFXLEVBQ1gsTUFBZSxFQUNmLElBQXdDO0lBRXhDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7SUFFM0IsSUFBSSxNQUFNLEtBQUssU0FBUyxFQUFFLENBQUM7UUFJMUIsTUFBTSxTQUFTLEdBQUcsWUFBWSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUUsQ0FBQyxDQUFFLENBQUMsQ0FBQztRQUNoRCxPQUFPLFNBQVMsQ0FBQztJQUNsQixDQUFDO0lBSUQsTUFBTSxvQkFBb0IsR0FBRyxJQUFJLGlCQUFTLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3pELE1BQU0sUUFBUSxHQUFHLElBQUksb0JBQW9CLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztJQUNuRCxPQUFPLFFBQVEsQ0FBQztBQUNqQixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsY0FBYyxDQUFDLGlCQUFTLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRTtJQUNuRCxHQUFHO1FBRUYsT0FBTyxnQkFBZ0IsQ0FBQztJQU16QixDQUFDO0NBQ0QsQ0FBQyxDQUFDO0FBS0gsaUJBQVMsQ0FBQyxTQUFTLENBQUMsU0FBUyxHQUFHLFVBQVUsT0FBZ0IsRUFBRSxJQUFlO0lBSTFFLE1BQU0sRUFDTCxRQUFRLEVBQUUsSUFBSSxFQUNkLE1BQU0sRUFDTixHQUFHLElBQUksQ0FBQztJQUtULE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUsvRCxNQUFNLGNBQWMsR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxpQ0FBZSxDQUFDLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFHakUsT0FBTyxRQUFRLENBQUM7QUFFakIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgdHlwZSB7IGNvbnN0cnVjdG9yT3B0aW9ucywgQ29uc3RydWN0b3JGdW5jdGlvbiB9IGZyb20gJy4uLy4uL3R5cGVzJztcblxuaW1wb3J0IFR5cGVzVXRpbHMgZnJvbSAnLi4vdXRpbHMnO1xuY29uc3Qge1xuXHRjaGVja1Byb3RvLFxufSA9IFR5cGVzVXRpbHM7XG5cbmltcG9ydCB7IGhvcCB9IGZyb20gJy4uLy4uL3V0aWxzL2hvcCc7XG5cbmltcG9ydCB7IEVycm9yc1R5cGVzIH0gZnJvbSAnLi4vLi4vZGVzY3JpcHRvcnMvZXJyb3JzJztcbmNvbnN0IHtcblx0V1JPTkdfVFlQRV9ERUZJTklUSU9OLFxufSA9IEVycm9yc1R5cGVzO1xuXG5pbXBvcnQgbW5lbW9zeW5lcyBmcm9tICcuL01uZW1vc3luZSc7XG5jb25zdCB7IGNyZWF0ZU1uZW1vc3luZSwgZ2V0RGVmYXVsdFByb3RvdHlwZSB9ID0gbW5lbW9zeW5lcztcblxuaW1wb3J0IHsgSW5zdGFuY2VDcmVhdG9yIH0gZnJvbSAnLi9JbnN0YW5jZUNyZWF0b3InO1xuXG4vLyBUeXBlIGZvciBUeXBlUHJveHkgaW5zdGFuY2VcbmV4cG9ydCBpbnRlcmZhY2UgVHlwZVByb3h5SW5zdGFuY2Uge1xuXHRfX3R5cGVfXzogeyBba2V5OiBzdHJpbmddOiB1bmtub3duOyBwcm90bzogb2JqZWN0OyBzdWJ0eXBlczogTWFwPHN0cmluZywgdW5rbm93bj47IGRlZmluZTogKG46IHN0cmluZywgYzogQ2FsbGFibGVGdW5jdGlvbiwgY2Y/OiBvYmplY3QsIC4uLmZhOiB1bmtub3duW10pID0+IHVua25vd24gfTtcblx0VXJhbnVzOiB1bmtub3duO1xuXHRnZXQodGFyZ2V0OiBDYWxsYWJsZUZ1bmN0aW9uLCBwcm9wOiBzdHJpbmcpOiB1bmtub3duO1xuXHRzZXQodGFyZ2V0OiB1bmtub3duLCBuYW1lOiBzdHJpbmcsIHZhbHVlOiB1bmtub3duKTogYm9vbGVhbjtcblx0Y29uc3RydWN0KHRhcmdldDogdW5rbm93biwgYXJnczogdW5rbm93bltdKTogb2JqZWN0O1xuXHRhcHBseTogdHlwZW9mIHN1YlR5cGVBcHBseTtcblx0bmV3ICguLi5hcmdzOiB1bmtub3duW10pOiBvYmplY3Q7XG59XG5cbmV4cG9ydCBjb25zdCBUeXBlUHJveHkgPSBmdW5jdGlvbiAoX190eXBlX186IFR5cGVQcm94eUluc3RhbmNlWydfX3R5cGVfXyddLCBVcmFudXM6IHVua25vd24pIHtcblx0T2JqZWN0LmFzc2lnbih0aGlzLCB7XG5cdFx0X190eXBlX18sXG5cdFx0VXJhbnVzXG5cdH0pO1xuXHRjb25zdCB0eXBlUHJveHkgPSBuZXcgUHJveHkoSW5zdGFuY2VDcmVhdG9yLCB0aGlzKTtcblx0cmV0dXJuIHR5cGVQcm94eTtcbn0gYXMgQ29uc3RydWN0b3JGdW5jdGlvbjxUeXBlUHJveHlJbnN0YW5jZT47XG5cblR5cGVQcm94eS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHRhcmdldDogQ2FsbGFibGVGdW5jdGlvbiwgcHJvcDogc3RyaW5nKSB7XG5cblx0Ly8gY29uc3QgcHJvcHMgPSBfZ2V0UHJvcHModGhpcykgYXMgUHJvcHM7XG5cblx0Y29uc3Qge1xuXHRcdF9fdHlwZV9fOiB0eXBlXG5cdH0gPSB0aGlzO1xuXG5cdC8vIHByb3RvdHlwZSBvZiBwcm94eVxuXHQvLyBjb25zdCBpbnN0YW5jZSA9IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2YocmVjZWl2ZXIpO1xuXG5cdGlmIChwcm9wID09PSAncHJvdG90eXBlJykge1xuXHRcdHJldHVybiB0eXBlLnByb3RvO1xuXHR9XG5cblx0Y29uc3QgcHJvcERlY2xhcmF0aW9uID0gdHlwZVsgcHJvcCBdO1xuXHRpZiAocHJvcERlY2xhcmF0aW9uKSB7XG5cdFx0cmV0dXJuIHByb3BEZWNsYXJhdGlvbjtcblx0fVxuXG5cdC8vIHVzZWQgZm9yIGV4aXN0ZW50IHByb3BzIHdpdGggdmFsdWVcblx0Ly8gdW5kZWZpbmVkIHx8IG51bGwgfHwgZmFsc2Vcblx0aWYgKGhvcCh0eXBlLCBwcm9wKSkge1xuXHRcdHJldHVybiBwcm9wRGVjbGFyYXRpb247XG5cdH1cblxuXHQvLyBTb21lVHlwZS5Tb21lU3ViVHlwZVxuXHRpZiAodHlwZS5zdWJ0eXBlcy5oYXMocHJvcCkpIHtcblx0XHRyZXR1cm4gdHlwZS5zdWJ0eXBlcy5nZXQocHJvcCk7XG5cdH1cblxuXHRyZXR1cm4gUmVmbGVjdC5nZXQodGFyZ2V0LCBwcm9wKTtcblxufTtcblxuVHlwZVByb3h5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoX3RhcmdldDogdW5rbm93biwgbmFtZTogc3RyaW5nLCB2YWx1ZTogdW5rbm93bikge1xuXG5cdGNvbnN0IHtcblx0XHRfX3R5cGVfXzogdHlwZVxuXHR9ID0gdGhpcztcblxuXHQvLyBpcyBhYm91dCBzZXR0aW5nIGEgcHJvdG90eXBlIHRvIFR5cGVcblx0aWYgKG5hbWUgPT09ICdwcm90b3R5cGUnKSB7XG5cdFx0Y2hlY2tQcm90byh2YWx1ZSk7XG5cdFx0T2JqZWN0LmFzc2lnbih0eXBlLnByb3RvLCB2YWx1ZSk7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnIHx8ICFuYW1lLmxlbmd0aCkge1xuXHRcdHRocm93IG5ldyBXUk9OR19UWVBFX0RFRklOSVRJT04oJ3Nob3VsZCB1c2Ugbm9uIGVtcHR5IHN0cmluZyBhcyBUeXBlTmFtZScpO1xuXHR9XG5cblx0aWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ2Z1bmN0aW9uJykge1xuXHRcdHRocm93IG5ldyBXUk9OR19UWVBFX0RFRklOSVRJT04oJ3Nob3VsZCB1c2UgZnVuY3Rpb24gZm9yIHR5cGUgZGVmaW5pdGlvbicpO1xuXHR9XG5cblx0Y29uc3QgVHlwZU5hbWUgPSBuYW1lO1xuXHRjb25zdCBDb25zdHJ1Y3RvciA9IHZhbHVlO1xuXG5cdHR5cGUuZGVmaW5lKFR5cGVOYW1lLCBDb25zdHJ1Y3Rvcik7XG5cdHJldHVybiB0cnVlO1xuXG59O1xuXG5cbi8vIHNoYXJlIGRlY29yYXRvciBmcm9tIHByaW1hcnkgdHlwZVxuY29uc3Qgc3ViVHlwZUFwcGx5ID0gKFxuXHRwYXJlbnRUeXBlOiB7IGRlZmluZTogKG46IHN0cmluZywgYzogQ2FsbGFibGVGdW5jdGlvbiwgY2Y/OiBvYmplY3QsIC4uLmZhOiB1bmtub3duW10pID0+IHVua25vd24gfSxcblx0Y2ZnPzogY29uc3RydWN0b3JPcHRpb25zLFxuXHQuLi5mbkFyZ3M6IHVua25vd25bXVxuKSA9PiB7XG5cdC8vIGNvbnN0IGRlY29yYXRvciA9IGZ1bmN0aW9uIDxUIGV4dGVuZHMgeyBuZXcgKCk6IHVua25vd24gfT4oY3N0cjogVCwgcz86IENsYXNzRGVjb3JhdG9yQ29udGV4dDxUPik6IFQge1xuXHRjb25zdCBkZWNvcmF0b3IgPSBmdW5jdGlvbiA8VCBleHRlbmRzIHsgbmV3ICgpOiB1bmtub3duIH0+KGNzdHI6IFQpOiBUIHtcblx0XHQvLyBjb25zdCBuYW1lID0gdHlwZW9mIHMgPT09ICdvYmplY3QnID8gcy5uYW1lIDogY3N0ci5jb25zdHJ1Y3Rvci5uYW1lO1xuXHRcdGNvbnN0IHsgbmFtZSB9ID0gY3N0cjtcblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldHVybiBwYXJlbnRUeXBlLmRlZmluZShuYW1lLCBjc3RyLCBjZmcsIC4uLmZuQXJncykgYXMgdW5rbm93biBhcyBUO1xuXHR9O1xuXHRyZXR1cm4gZGVjb3JhdG9yO1xufTtcblxuLy8gcmVwbGFjZSBpbnN0YW5jZSBwcm90b3R5cGVcbmNvbnN0IHByaW1hcnlUeXBlQXBwbHkgPSBmdW5jdGlvbiAoXG5cdHRoaXM6IFR5cGVQcm94eUluc3RhbmNlLFxuXHQvLyBwcm94eSB0YXJnZXRcblx0X186IHVua25vd24sXG5cdFVyYW51czogdW5rbm93bixcblx0YXJnczogW2NvbnN0cnVjdG9yT3B0aW9ucywgLi4udW5rbm93bltdXSxcbikge1xuXHRjb25zdCB0eXBlID0gdGhpcy5fX3R5cGVfXztcblx0Ly8gY2FzZSBvZiBkZWNvcmF0b3IgbGlrZSB1c2FnZVxuXHRpZiAoVXJhbnVzID09PSB1bmRlZmluZWQpIHtcblx0XHQvLyBzbyBpbnN0ZWFkIG9mXG5cdFx0Ly8gaW5zdGFuY2UgPSB0aGlzLmNvbnN0cnVjdChudWxsLCBhcmdzKTtcblx0XHQvLyB3ZSB3aWxsIHJldHVybiBkZWNvcmF0b3Jcblx0XHRjb25zdCBkZWNvcmF0b3IgPSBzdWJUeXBlQXBwbHkodHlwZSwgYXJnc1sgMCBdKTtcblx0XHRyZXR1cm4gZGVjb3JhdG9yO1xuXHR9XG5cblx0Ly8gdGhpcyBpcyB0aGUgc2NlbmFyaW8sIHdoZW4gd2UgLmNhbGwgb3IgLmFwcGx5IG9yIC5iaW5kXG5cdC8vIG91ciBQcmltYXJ5VHlwZSB3aGljayBpcyA9PT0gaW5zdGFuY2Ugb2YgY3VycmVudCBUeXBlUHJveHlcblx0Y29uc3QgSW5zdGFuY2VDcmVhdG9yUHJveHkgPSBuZXcgVHlwZVByb3h5KHR5cGUsIFVyYW51cyk7XG5cdGNvbnN0IGluc3RhbmNlID0gbmV3IEluc3RhbmNlQ3JlYXRvclByb3h5KC4uLmFyZ3MpO1xuXHRyZXR1cm4gaW5zdGFuY2U7XG59O1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoVHlwZVByb3h5LnByb3RvdHlwZSwgJ2FwcGx5Jywge1xuXHRnZXQgKCkge1xuXHRcdC8vIGNvbnN0IHR5cGUgPSB0aGlzLl9fdHlwZV9fO1xuXHRcdHJldHVybiBwcmltYXJ5VHlwZUFwcGx5O1xuXHRcdC8vIGNvbnN0IGFuc3dlciA9ICF0eXBlLmlzU3ViVHlwZSA/IHByaW1hcnlUeXBlQXBwbHkgOiBcblx0XHQvLyBcdChfXzogdW5rbm93biwgX19fOiB1bmtub3duLCBjb25maWc/OiBjb25zdHJ1Y3Rvck9wdGlvbnMsIC4uLmFyZ3M6IHVua25vd25bXSkgPT4ge1xuXHRcdC8vIFx0XHRyZXR1cm4gc3ViVHlwZUFwcGx5KHR5cGUsIGNvbmZpZywgLi4uYXJncyk7XG5cdFx0Ly8gXHR9O1xuXHRcdC8vIHJldHVybiBhbnN3ZXI7XG5cdH1cbn0pO1xuXG5cbi8vIHRoaXMgYWx3YXlzIGlzIGluaXRpYWwgdHlwZSBjcmVhdGlvbiAuLi5cbi8vIHNvIG5vIHdheSB0byBpbnZva2UgdGhpcyBvdGhlcndpc2UgdGhhbiBkaXJlY3QgdHlwZSBjYWxsXG5UeXBlUHJveHkucHJvdG90eXBlLmNvbnN0cnVjdCA9IGZ1bmN0aW9uIChfdGFyZ2V0OiB1bmtub3duLCBhcmdzOiB1bmtub3duW10pIHtcblxuXHQvLyBuZXcudGFyZ2V0IGlkIGVxdWFsIHdpdGggdGFyZ2V0IGhlcmVcblxuXHRjb25zdCB7XG5cdFx0X190eXBlX186IHR5cGUsXG5cdFx0VXJhbnVzXG5cdH0gPSB0aGlzO1xuXG5cdC8vIHNvIHRoaXMgaXMgYSBkaXJlY3QgU3ViLVR5cGUgaW52b2NhdGlvblxuXHQvLyBoYXZpbmcgbm8gZXhpc3RlbnRJbnN0YW5jZSBjcmVhdGVkIGVhcmxpZXJcblx0Ly8gdGhlbiB3ZSBzaG91bGQgcmVseSBvbiB0aGF0IHNvbWVob3dcblx0Y29uc3QgdXJhbnVzID0gdHlwZS5pc1N1YlR5cGUgPyBnZXREZWZhdWx0UHJvdG90eXBlKCkgOiBVcmFudXM7XG5cblx0Ly8gXCJ0aGlzXCIgYXJndW1lbnQgbWF5IGJlIHBhc3NlZCBmb3IgdHJhY2tpbmcgd2h5IHNvbWV0aGluZyBoYXBwZW5lZFxuXHQvLyBidXQgdW5jb21tZW50IGl0IHRoZXJlIGluIGNyZWF0ZU1uZW1vc3luZSBpZiBuZWVkZWRcblx0Ly8gY29uc3QgbW5lbW9zeW5lUHJveHkgPSBjcmVhdGVNbmVtb3N5bmUodXJhbnVzLCB0aGlzKTtcblx0Y29uc3QgbW5lbW9zeW5lUHJveHkgPSBjcmVhdGVNbmVtb3N5bmUodXJhbnVzKTtcblx0Y29uc3QgaW5zdGFuY2UgPSBuZXcgSW5zdGFuY2VDcmVhdG9yKHR5cGUsIG1uZW1vc3luZVByb3h5LCBhcmdzKTtcblxuXHQvLyBjb25zdCBpbnN0YW5jZSA9IG5ldyBJbnN0YW5jZUNyZWF0b3IodHlwZSwgbnVsbCwgYXJncyk7XG5cdHJldHVybiBpbnN0YW5jZTtcblxufTtcbiJdfQ==