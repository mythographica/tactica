'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.collectConstructors = void 0;
const constants_1 = require("../constants");
const { MNEMOSYNE, MNEMONICA, } = constants_1.constants;
const getAdditor = (constructors) => {
    return Array.isArray(constructors) ?
        (name) => {
            constructors.push(name);
        } : (name) => {
        constructors[name] = true;
    };
};
const getAccumulator = (asSequence) => {
    return asSequence ? [] : {};
};
const collectConstructors = (self, asSequence = false) => {
    const constructors = getAccumulator(asSequence);
    const addToSequence = getAdditor(constructors);
    if (typeof self === 'object') {
        if (self === null) {
            return constructors;
        }
    }
    else {
        return constructors;
    }
    let proto = Reflect.getPrototypeOf(self);
    let mnemonicaReached = false;
    while (proto) {
        if (proto.constructor) {
            const constructorName = proto.constructor.name;
            if (constructorName === MNEMONICA && !mnemonicaReached) {
                if (Object.hasOwnProperty.call(proto, 'constructor')) {
                    addToSequence(constructorName);
                    addToSequence(MNEMOSYNE);
                    mnemonicaReached = true;
                }
            }
            else if (constructorName === 'Object') {
                addToSequence(constructorName);
                break;
            }
            else {
                addToSequence(constructorName);
            }
        }
        if (mnemonicaReached) {
            break;
        }
        self = proto;
        proto = Reflect.getPrototypeOf(self);
        if (proto === null) {
            addToSequence('Object: null prototype');
            break;
        }
    }
    return constructors;
};
exports.collectConstructors = collectConstructors;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdENvbnN0cnVjdG9ycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9jb2xsZWN0Q29uc3RydWN0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7O0FBRWIsNENBQXlDO0FBRXpDLE1BQU0sRUFDTCxTQUFTLEVBQ1QsU0FBUyxHQUVULEdBQUcscUJBQVMsQ0FBQztBQUVkLE1BQU0sVUFBVSxHQUFHLENBQUMsWUFBcUQsRUFBRSxFQUFFO0lBQzVFLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ25DLENBQUMsSUFBWSxFQUFFLEVBQUU7WUFDaEIsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBWSxFQUFFLEVBQUU7UUFDcEIsWUFBWSxDQUFFLElBQUksQ0FBRSxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDLENBQUM7QUFFSixDQUFDLENBQUM7QUFFRixNQUFNLGNBQWMsR0FBRyxDQUFDLFVBQW1CLEVBQUUsRUFBRTtJQUM5QyxPQUFPLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDN0IsQ0FBQyxDQUFDO0FBRUssTUFBTSxtQkFBbUIsR0FBRyxDQUFDLElBQVksRUFBRSxVQUFVLEdBQUcsS0FBSyxFQUFFLEVBQUU7SUFFdkUsTUFBTSxZQUFZLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sYUFBYSxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUUvQyxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzlCLElBQUksSUFBSSxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ25CLE9BQU8sWUFBWSxDQUFDO1FBQ3JCLENBQUM7SUFDRixDQUFDO1NBQU0sQ0FBQztRQUNQLE9BQU8sWUFBWSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxJQUFJLEtBQUssR0FBWSxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWxELElBQUksZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO0lBQzdCLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZCxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2QixNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztZQUMvQyxJQUFJLGVBQWUsS0FBSyxTQUFTLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUN4RCxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsRUFBRSxDQUFDO29CQUN0RCxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBQy9CLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDekIsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO2dCQUN6QixDQUFDO1lBQ0YsQ0FBQztpQkFBTSxJQUFJLGVBQWUsS0FBSyxRQUFRLEVBQUUsQ0FBQztnQkFDekMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUMvQixNQUFNO1lBQ1AsQ0FBQztpQkFBTSxDQUFDO2dCQUNQLGFBQWEsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNoQyxDQUFDO1FBQ0YsQ0FBQztRQUVELElBQUksZ0JBQWdCLEVBQUUsQ0FBQztZQUN0QixNQUFNO1FBQ1AsQ0FBQztRQUVELElBQUksR0FBRyxLQUFLLENBQUM7UUFDYixLQUFLLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxJQUFJLEtBQUssS0FBSyxJQUFJLEVBQUUsQ0FBQztZQUNwQixhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUN4QyxNQUFNO1FBQ1AsQ0FBQztJQVdGLENBQUM7SUFDRCxPQUFPLFlBQVksQ0FBQztBQUNyQixDQUFDLENBQUM7QUF2RFcsUUFBQSxtQkFBbUIsdUJBdUQ5QiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgY29uc3RhbnRzIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcblxuY29uc3Qge1xuXHRNTkVNT1NZTkUsXG5cdE1ORU1PTklDQSxcblx0Ly8gU3ltYm9sQ29uc3RydWN0b3JOYW1lXG59ID0gY29uc3RhbnRzO1xuXG5jb25zdCBnZXRBZGRpdG9yID0gKGNvbnN0cnVjdG9yczogc3RyaW5nW10gfCB7IFtpbmRleDogc3RyaW5nXTogYm9vbGVhbiB9KSA9PiB7XG5cdHJldHVybiBBcnJheS5pc0FycmF5KGNvbnN0cnVjdG9ycykgP1xuXHRcdChuYW1lOiBzdHJpbmcpID0+IHtcblx0XHRcdGNvbnN0cnVjdG9ycy5wdXNoKG5hbWUpO1xuXHRcdH0gOiAobmFtZTogc3RyaW5nKSA9PiB7XG5cdFx0XHRjb25zdHJ1Y3RvcnNbIG5hbWUgXSA9IHRydWU7XG5cdFx0fTtcblxufTtcblxuY29uc3QgZ2V0QWNjdW11bGF0b3IgPSAoYXNTZXF1ZW5jZTogYm9vbGVhbikgPT4ge1xuXHRyZXR1cm4gYXNTZXF1ZW5jZSA/IFtdIDoge307XG59O1xuXG5leHBvcnQgY29uc3QgY29sbGVjdENvbnN0cnVjdG9ycyA9IChzZWxmOiBvYmplY3QsIGFzU2VxdWVuY2UgPSBmYWxzZSkgPT4ge1xuXG5cdGNvbnN0IGNvbnN0cnVjdG9ycyA9IGdldEFjY3VtdWxhdG9yKGFzU2VxdWVuY2UpO1xuXHRjb25zdCBhZGRUb1NlcXVlbmNlID0gZ2V0QWRkaXRvcihjb25zdHJ1Y3RvcnMpO1xuXG5cdGlmICh0eXBlb2Ygc2VsZiA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAoc2VsZiA9PT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIGNvbnN0cnVjdG9ycztcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0cmV0dXJuIGNvbnN0cnVjdG9ycztcblx0fVxuXG5cdGxldCBwcm90bzogdW5rbm93biA9IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2Yoc2VsZik7XG5cblx0bGV0IG1uZW1vbmljYVJlYWNoZWQgPSBmYWxzZTtcblx0d2hpbGUgKHByb3RvKSB7XG5cdFx0aWYgKHByb3RvLmNvbnN0cnVjdG9yKSB7XG5cdFx0XHRjb25zdCBjb25zdHJ1Y3Rvck5hbWUgPSBwcm90by5jb25zdHJ1Y3Rvci5uYW1lO1xuXHRcdFx0aWYgKGNvbnN0cnVjdG9yTmFtZSA9PT0gTU5FTU9OSUNBICYmICFtbmVtb25pY2FSZWFjaGVkKSB7XG5cdFx0XHRcdGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChwcm90bywgJ2NvbnN0cnVjdG9yJykpIHtcblx0XHRcdFx0XHRhZGRUb1NlcXVlbmNlKGNvbnN0cnVjdG9yTmFtZSk7XG5cdFx0XHRcdFx0YWRkVG9TZXF1ZW5jZShNTkVNT1NZTkUpO1xuXHRcdFx0XHRcdG1uZW1vbmljYVJlYWNoZWQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKGNvbnN0cnVjdG9yTmFtZSA9PT0gJ09iamVjdCcpIHtcblx0XHRcdFx0YWRkVG9TZXF1ZW5jZShjb25zdHJ1Y3Rvck5hbWUpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGFkZFRvU2VxdWVuY2UoY29uc3RydWN0b3JOYW1lKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAobW5lbW9uaWNhUmVhY2hlZCkge1xuXHRcdFx0YnJlYWs7XG5cdFx0fVxuXHRcdFxuXHRcdHNlbGYgPSBwcm90bztcblx0XHRwcm90byA9IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2Yoc2VsZik7XG5cdFx0aWYgKHByb3RvID09PSBudWxsKSB7XG5cdFx0XHRhZGRUb1NlcXVlbmNlKCdPYmplY3Q6IG51bGwgcHJvdG90eXBlJyk7XG5cdFx0XHRicmVhaztcblx0XHR9XG5cdFx0Lypcblx0XHRUT0RPOiBzaG93IGZ1bGwgY2hhaW4gYW5kIHRlc3QgaXQgISEhXG5cdFx0ZWxzZSB7XG5cdFx0XHQvLyBwcm90byBtYXkgYmUgZWl0aGVyIGVtcHR5IG9iamVjdCBvciBudWxsXG5cdFx0XHQvLyBzbyB0eXBlb2Ygd2lsbCBhbHdheXMgYmUgJ29iamVjdCdcblx0XHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1sb25lbHktaWZcblx0XHRcdGFkZFRvU2VxdWVuY2UoJy4uLiBwbGFpbiBvYmplY3QgLi4uJyk7XG5cdFx0fVxuXHRcdCovXG5cdFx0Ly8gc28gaGVyZSB3ZSBnbyBkZWVwZXIgdG8gdGhlIGNoYWluXG5cdH1cblx0cmV0dXJuIGNvbnN0cnVjdG9ycztcbn07XG4iXX0=