'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.parse = void 0;
const errors_1 = require("../descriptors/errors");
const { WRONG_MODIFICATION_PATTERN, WRONG_ARGUMENTS_USED } = errors_1.ErrorsTypes;
const extract_1 = require("./extract");
const parse = (self) => {
    if (!self || !self.constructor) {
        throw new WRONG_MODIFICATION_PATTERN;
    }
    const proto = Reflect.getPrototypeOf(self);
    const selfConstructor = self.constructor;
    const protoConstructor = proto.constructor;
    if (selfConstructor.name.toString() !== protoConstructor.name.toString()) {
        throw new WRONG_ARGUMENTS_USED(`have to use "instance" itself: '${selfConstructor.name}' vs '${protoConstructor.name}'`);
    }
    const protoProto = Reflect.getPrototypeOf(proto);
    if (protoProto) {
        const protoProtoConstructor = protoProto.constructor;
        if (protoProtoConstructor && protoConstructor.name.toString() !== protoProtoConstructor.name.toString()) {
            throw new WRONG_ARGUMENTS_USED(`have to use "instance" itself: '${protoConstructor.name}' vs '${protoProtoConstructor.name}'`);
        }
    }
    const { name } = protoConstructor;
    const props = (0, extract_1.extract)({ ...self });
    delete props.constructor;
    const joint = (0, extract_1.extract)(Object.assign({}, proto));
    delete joint.constructor;
    const parent = protoProto;
    return {
        name,
        props,
        self,
        proto,
        joint,
        parent,
    };
};
exports.parse = parse;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvcGFyc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUFFYixrREFBb0Q7QUFDcEQsTUFBTSxFQUNMLDBCQUEwQixFQUMxQixvQkFBb0IsRUFDcEIsR0FBRyxvQkFBVyxDQUFDO0FBUWhCLHVDQUFvQztBQUU3QixNQUFNLEtBQUssR0FBRyxDQUFFLElBQVksRUFBRyxFQUFFO0lBRXZDLElBQUssQ0FBQyxJQUFJLElBQUksQ0FBRyxJQUE0QyxDQUFDLFdBQVcsRUFBRyxDQUFDO1FBQzVFLE1BQU0sSUFBSSwwQkFBMEIsQ0FBQztJQUN0QyxDQUFDO0lBRUQsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBRSxJQUFJLENBQVksQ0FBQztJQUV2RCxNQUFNLGVBQWUsR0FBSyxJQUEyQyxDQUFDLFdBQVcsQ0FBQztJQUNsRixNQUFNLGdCQUFnQixHQUFLLEtBQTRDLENBQUMsV0FBVyxDQUFDO0lBRXBGLElBQUssZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUcsQ0FBQztRQUM1RSxNQUFNLElBQUksb0JBQW9CLENBQUUsbUNBQW1DLGVBQWUsQ0FBQyxJQUFJLFNBQVMsZ0JBQWdCLENBQUMsSUFBSSxHQUFHLENBQUUsQ0FBQztJQUM1SCxDQUFDO0lBRUQsTUFBTSxVQUFVLEdBQVksT0FBTyxDQUFDLGNBQWMsQ0FBRSxLQUFLLENBQUUsQ0FBQztJQUM1RCxJQUFLLFVBQVUsRUFBRyxDQUFDO1FBQ2xCLE1BQU0scUJBQXFCLEdBQUssVUFBa0QsQ0FBQyxXQUFXLENBQUM7UUFDL0YsSUFBSyxxQkFBcUIsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUsscUJBQXFCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFHLENBQUM7WUFDM0csTUFBTSxJQUFJLG9CQUFvQixDQUFFLG1DQUFtQyxnQkFBZ0IsQ0FBQyxJQUFJLFNBQVMscUJBQXFCLENBQUMsSUFBSSxHQUFHLENBQUUsQ0FBQztRQUNsSSxDQUFDO0lBQ0YsQ0FBQztJQUtELE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxnQkFBZ0IsQ0FBQztJQUVsQyxNQUFNLEtBQUssR0FBRyxJQUFBLGlCQUFPLEVBQUUsRUFBRSxHQUFHLElBQUksRUFBNkIsQ0FBRSxDQUFDO0lBRWhFLE9BQVMsS0FBb0MsQ0FBQyxXQUFXLENBQUM7SUFFMUQsTUFBTSxLQUFLLEdBQUcsSUFBQSxpQkFBTyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUUsRUFBRSxFQUFFLEtBQUssQ0FBNkIsQ0FBRSxDQUFDO0lBQy9FLE9BQVMsS0FBb0MsQ0FBQyxXQUFXLENBQUM7SUFFMUQsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDO0lBUzFCLE9BQU87UUFFTixJQUFJO1FBRUosS0FBSztRQUdMLElBQUk7UUFDSixLQUFLO1FBRUwsS0FBSztRQUVMLE1BQU07S0FFTixDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBM0RXLFFBQUEsS0FBSyxTQTJEaEIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IEVycm9yc1R5cGVzIH0gZnJvbSAnLi4vZGVzY3JpcHRvcnMvZXJyb3JzJztcbmNvbnN0IHtcblx0V1JPTkdfTU9ESUZJQ0FUSU9OX1BBVFRFUk4sXG5cdFdST05HX0FSR1VNRU5UU19VU0VEXG59ID0gRXJyb3JzVHlwZXM7XG5cbi8vIGltcG9ydCB7IGNvbnN0YW50cyB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG4vLyBjb25zdCB7XG4vLyBcdE1ORU1PTklDQSxcbi8vIFx0U3ltYm9sQ29uc3RydWN0b3JOYW1lXG4vLyB9ID0gY29uc3RhbnRzO1xuXG5pbXBvcnQgeyBleHRyYWN0IH0gZnJvbSAnLi9leHRyYWN0JztcblxuZXhwb3J0IGNvbnN0IHBhcnNlID0gKCBzZWxmOiBvYmplY3QgKSA9PiB7XG5cblx0aWYgKCAhc2VsZiB8fCAhKCBzZWxmIGFzIHsgY29uc3RydWN0b3I/OiBDYWxsYWJsZUZ1bmN0aW9uIH0gKS5jb25zdHJ1Y3RvciApIHtcblx0XHR0aHJvdyBuZXcgV1JPTkdfTU9ESUZJQ0FUSU9OX1BBVFRFUk47XG5cdH1cblxuXHRjb25zdCBwcm90byA9IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2YoIHNlbGYgKSBhcyBvYmplY3Q7XG5cblx0Y29uc3Qgc2VsZkNvbnN0cnVjdG9yID0gKCBzZWxmIGFzIHsgY29uc3RydWN0b3I6IHsgbmFtZTogc3RyaW5nIH0gfSApLmNvbnN0cnVjdG9yO1xuXHRjb25zdCBwcm90b0NvbnN0cnVjdG9yID0gKCBwcm90byBhcyB7IGNvbnN0cnVjdG9yOiB7IG5hbWU6IHN0cmluZyB9IH0gKS5jb25zdHJ1Y3RvcjtcblxuXHRpZiAoIHNlbGZDb25zdHJ1Y3Rvci5uYW1lLnRvU3RyaW5nKCkgIT09IHByb3RvQ29uc3RydWN0b3IubmFtZS50b1N0cmluZygpICkge1xuXHRcdHRocm93IG5ldyBXUk9OR19BUkdVTUVOVFNfVVNFRCggYGhhdmUgdG8gdXNlIFwiaW5zdGFuY2VcIiBpdHNlbGY6ICcke3NlbGZDb25zdHJ1Y3Rvci5uYW1lfScgdnMgJyR7cHJvdG9Db25zdHJ1Y3Rvci5uYW1lfSdgICk7XG5cdH1cblxuXHRjb25zdCBwcm90b1Byb3RvOiB1bmtub3duID0gUmVmbGVjdC5nZXRQcm90b3R5cGVPZiggcHJvdG8gKTtcblx0aWYgKCBwcm90b1Byb3RvICkge1xuXHRcdGNvbnN0IHByb3RvUHJvdG9Db25zdHJ1Y3RvciA9ICggcHJvdG9Qcm90byBhcyB7IGNvbnN0cnVjdG9yPzogeyBuYW1lOiBzdHJpbmcgfSB9ICkuY29uc3RydWN0b3I7XG5cdFx0aWYgKCBwcm90b1Byb3RvQ29uc3RydWN0b3IgJiYgcHJvdG9Db25zdHJ1Y3Rvci5uYW1lLnRvU3RyaW5nKCkgIT09IHByb3RvUHJvdG9Db25zdHJ1Y3Rvci5uYW1lLnRvU3RyaW5nKCkgKSB7XG5cdFx0XHR0aHJvdyBuZXcgV1JPTkdfQVJHVU1FTlRTX1VTRUQoIGBoYXZlIHRvIHVzZSBcImluc3RhbmNlXCIgaXRzZWxmOiAnJHtwcm90b0NvbnN0cnVjdG9yLm5hbWV9JyB2cyAnJHtwcm90b1Byb3RvQ29uc3RydWN0b3IubmFtZX0nYCApO1xuXHRcdH1cblx0fVxuXG5cdC8vIGNvbnN0IGFyZ3MgPSBzZWxmW1N5bWJvbENvbnN0cnVjdG9yTmFtZV0gP1xuXHQvLyBzZWxmW1N5bWJvbENvbnN0cnVjdG9yTmFtZV0uYXJncyA6IFtdO1xuXG5cdGNvbnN0IHsgbmFtZSB9ID0gcHJvdG9Db25zdHJ1Y3RvcjtcblxuXHRjb25zdCBwcm9wcyA9IGV4dHJhY3QoIHsgLi4uc2VsZiB9IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+ICk7XG5cdC8vIHByb3BzLmNvbnN0cnVjdG9yID0gdW5kZWZpbmVkO1xuXHRkZWxldGUgKCBwcm9wcyBhcyB7IGNvbnN0cnVjdG9yPzogdW5rbm93biB9ICkuY29uc3RydWN0b3I7XG5cblx0Y29uc3Qgam9pbnQgPSBleHRyYWN0KCBPYmplY3QuYXNzaWduKCB7fSwgcHJvdG8gKSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiApO1xuXHRkZWxldGUgKCBqb2ludCBhcyB7IGNvbnN0cnVjdG9yPzogdW5rbm93biB9ICkuY29uc3RydWN0b3I7XG5cblx0Y29uc3QgcGFyZW50ID0gcHJvdG9Qcm90bztcblx0Ly8gVE9ETzogZGVlcCBwYXJzZVxuXHQvLyBsZXQgcGFyZW50O1xuXHQvLyBpZiAoIHByb3RvUHJvdG9bIFN5bWJvbENvbnN0cnVjdG9yTmFtZSBdID09PSBNTkVNT05JQ0EgKSB7XG5cdC8vIFx0cGFyZW50ID0gcGFyc2UoIHByb3RvUHJvdG8gKTtcblx0Ly8gfSBlbHNlIHtcblx0Ly8gXHRwYXJlbnQgPSBSZWZsZWN0LmdldFByb3RvdHlwZU9mKCBwcm90b1Byb3RvICk7XG5cdC8vIH1cblxuXHRyZXR1cm4ge1xuXG5cdFx0bmFtZSxcblxuXHRcdHByb3BzLFxuXHRcdC8vIHRoZSBsaW5lIGJlbG93IGNvcHkgc3ltYm9scyBhbHNvXG5cblx0XHRzZWxmLFxuXHRcdHByb3RvLFxuXG5cdFx0am9pbnQsXG5cdFx0Ly8gYXJncyxcblx0XHRwYXJlbnQsXG5cblx0fTtcbn07XG4iXX0=